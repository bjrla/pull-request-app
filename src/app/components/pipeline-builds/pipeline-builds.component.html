<div class="pipeline-runs-container">
  <div class="header-section">
    <h2>Pipeline Runs - X5K8 Regular Transfers</h2>
    <div class="pipeline-info">
      <span class="pipeline-name">X5K8.RegularTransfers.WebApp</span>
      <a
        href="https://azuredevops.danskenet.net/Main/X5K8-Regular-Transfers/_build?definitionId=40500"
        target="_blank"
        class="pipeline-link"
      >
        View in Azure DevOps
      </a>
    </div>
    <button
      class="refresh-btn"
      (click)="loadPipelineRuns()"
      [disabled]="isLoading"
      type="button"
    >
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M4 4V9H4.582M4.582 9C5.24585 7.35812 6.43568 5.9829 7.96503 5.08985C9.49438 4.1968 11.2768 3.8379 13.033 4.06532C14.7891 4.29274 16.4198 5.09676 17.6694 6.35377C18.919 7.61079 19.7168 9.24692 19.9382 11.0064C20.1596 12.7659 19.7936 14.5463 18.8943 16.0711C17.995 17.5958 16.6059 18.7795 14.9581 19.4351C13.3103 20.0907 11.4956 20.1789 9.79471 19.6877C8.09382 19.1965 6.59716 18.1555 5.5 16.7M4.582 9H9"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      Refresh
    </button>
  </div>

  @if (error) {
  <app-error-message [message]="error"></app-error-message>
  } @if (isLoading) {
  <app-loading></app-loading>
  } @if (!isLoading && !error && pipelineRuns.length === 0) {
  <app-no-data message="No pipeline runs found."></app-no-data>
  } @if (!isLoading && !error && pipelineRuns.length > 0) {
  <div class="pipeline-runs-list">
    <div class="runs-header">
      <h3>{{ pipelineRuns.length }} pipeline runs</h3>
    </div>

    @for (run of pipelineRuns; track run.id) {
    <div class="pipeline-run-row" [class]="getStatusClass(run)">
      <!-- Build Number and Title -->
      <div class="run-title-section">
        <div class="build-title">
          <a [href]="getPipelineUrl(run)" target="_blank" class="build-link">
            {{ run.buildNumber }} {{ run.commitMessage || "Pipeline Run" }}
          </a>
        </div>
        <div class="build-meta">
          <span class="pipeline-name"
            >Individual CI for {{ run.requestedFor.displayName }}</span
          >
          <a [href]="getPipelineUrl(run)" target="_blank" class="branch-link">
            <span class="branch-icon">ğŸŒ¿</span>
            {{ getBranchName(run.sourceBranch) }}
          </a>
          <a [href]="getPipelineUrl(run)" target="_blank" class="commit-link">
            <span class="commit-icon">ğŸ“</span>
            {{ run.shortSourceVersion }}
          </a>
        </div>
      </div>

      <!-- Pipeline Status -->
      <div class="status-section">
        <span class="pipeline-status" [class]="getStatusClass(run)">
          @switch (getStatusClass(run)) { @case ('succeeded') {
          <span class="status-icon success">âœ“</span>
          <span class="status-text">Succeeded</span>
          } @case ('failed') {
          <span class="status-icon error">âœ—</span>
          <span class="status-text">Failed</span>
          } @case ('in-progress') {
          <span class="status-icon progress">â³</span>
          <span class="status-text">In Progress</span>
          } @default {
          <span class="status-icon pending">â¸</span>
          <span class="status-text">{{ run.status || "Pending" }}</span>
          } }
        </span>
      </div>

      <!-- Timing Information -->
      <div class="timing-section">
        <div class="timing-item">
          <span class="time-icon">ğŸ•</span>
          <span class="relative-time">{{
            formatRelativeDate(run.finishTime || run.startTime || "")
          }}</span>
        </div>
        <div class="timing-item">
          <span class="duration-icon">â±</span>
          <span class="duration">{{ run.duration }}</span>
        </div>
      </div>
    </div>
    }
  </div>
  }
</div>
