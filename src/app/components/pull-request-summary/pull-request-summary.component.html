@if (pullRequests.length > 0) {
<div class="summary">
  <div class="summary-header">
    <h2>Summary</h2>
    <div class="summary-controls">
      <label class="draft-toggle">
        <input
          type="checkbox"
          [checked]="showDrafts"
          (change)="onToggleDrafts()"
        />
        <span class="toggle-text">Show drafts</span>
      </label>
      <button (click)="onRefresh()" [disabled]="isLoading" class="refresh-btn">
        {{ isLoading ? "Loading..." : "Refresh" }}
      </button>
    </div>
  </div>
  <div class="project-counts">
    @for (item of projectSummary; track item.project) {
    <div
      class="project-count"
      [class.selected]="isRepositorySelected(item.project)"
      [class.disabled]="!hasActivePRs(item.project)"
      [class.has-suggestions]="hasCreatePRSuggestions(item.project)"
      (click)="onFilterByRepository(item.project)"
    >
      <div class="repo-indicator">
        <div class="repo-header">
          <span class="project-name">{{ item.project }}</span>
        </div>
        <div
          class="repo-underline"
          [style.background-color]="getRepositoryColor(item.project)"
        ></div>
      </div>
      <span class="count"
        >{{ item.count }} PR{{ item.count !== 1 ? "s" : "" }}</span
      >

      <!-- PR Suggestions Section -->
      @if (hasCreatePRSuggestions(item.project)) {
      <div class="pr-suggestions">
        <div class="suggestions-header">You updated:</div>
        @for (suggestion of getSuggestionsForProject(item.project); track
        suggestion.properties.sourceBranch) {
        <div class="suggestion-item">
          <div class="suggestion-info">
            <span class="branch-name">{{
              suggestion.properties.sourceBranch.replace("refs/heads/", "")
            }}</span>
          </div>
          <button
            class="create-pr-suggestion-btn"
            (click)="onCreatePR(suggestion, $event)"
            title="Create pull request from {{
              suggestion.properties.sourceBranch.replace('refs/heads/', '')
            }}"
          >
            Create PR
          </button>
        </div>
        }
      </div>
      }
    </div>
    }
  </div>

  <!-- Author Filter Section -->
  @if (uniqueAuthors.length > 1) {
  <div class="author-filters">
    <h4>Authors</h4>
    <div class="author-filter-list">
      @for (author of uniqueAuthors; track author) {
      <div
        class="author-filter-item"
        [class.selected]="isAuthorSelected(author)"
        (click)="onFilterByAuthor(author)"
        [title]="
          author +
          ' (' +
          getPRCountForAuthor(author) +
          ' PR' +
          (getPRCountForAuthor(author) !== 1 ? 's' : '') +
          ')'
        "
      >
        <img
          class="author-avatar"
          [src]="getAuthorProfilePictureUrl(author)"
          [alt]="author"
          [attr.data-fallback-name]="author"
          (error)="onImageError($event)"
        />
        <span class="author-name">{{ author }}</span>
        <span class="pr-count">{{ getPRCountForAuthor(author) }}</span>
      </div>
      }
    </div>
  </div>
  }

  <div class="total-count">
    <div class="count-line">
      <strong
        >Total: {{ pullRequests.length }} active PR{{
          pullRequests.length !== 1 ? "s" : ""
        }}</strong
      >
      @if (draftCount > 0) {
      <span class="draft-info">
        ({{ regularCount }} regular, {{ draftCount }} draft{{
          draftCount !== 1 ? "s" : ""
        }})
      </span>
      } @if (!showDrafts && draftCount > 0) {
      <span class="current-view"
        >• {{ draftCount }} draft{{ draftCount !== 1 ? "s" : "" }} hidden</span
      >
      }
    </div>
    @if (selectedRepositories.size > 0 || selectedAuthors.size > 0) {
    <div class="filter-line">
      <span class="filter-info">
        Showing {{ filteredPullRequests.length }} @if (selectedRepositories.size
        > 0) { from {{ selectedRepositories.size }} repo{{
          selectedRepositories.size !== 1 ? "s" : ""
        }}: {{ getSelectedRepositoriesText() }} } @if (selectedRepositories.size
        > 0 && selectedAuthors.size > 0) { • } @if (selectedAuthors.size > 0) {
        by {{ selectedAuthors.size }} author{{
          selectedAuthors.size !== 1 ? "s" : ""
        }}: {{ getSelectedAuthorsText() }}
        }
      </span>
      <button (click)="onClearFilter()" class="clear-filter-btn">
        Clear Filter
      </button>
    </div>
    }
  </div>
</div>
}
